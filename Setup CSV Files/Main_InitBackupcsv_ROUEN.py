import os
import numpy as np 
import pandas as pd
from datetime import datetime

# Functions

def filter(nID,path,DFgen,conca):
	if conca == 1:
		df_filtro = DFgen.loc[DFgen.TagId == nID,: ]	#Temperatura Ambiente Exterior Compression tt21
		df_histo = pd.read_excel(path)
		df_Concatenate = pd.concat([df_histo, df_filtro], sort=True)
		df_Concatenate.to_excel(path, index=False)

	if conca == 0:
		df_filtro = DFgen.loc[DFgen.TagId == nID,: ]	#Temperatura Ambiente Exterior Compression tt21
		df_filtro.to_excel(path, index=False)


def InitDataFrames(StartupFile,path):
	df_Init = pd.read_excel(StartupFile)
	#df_Init.to_excel(path, index=False)
	df_Init.to_csv(path ,sep=';', index=False , encoding='utf-8')



StartUpFile =  'StartupFile.xlsx'

# HRS - H2M McView TAGS
IDsTag = {1:[1,"ALM_MOT","Mot contenant les alarmes"],
2:[99,"DEF_S1_KO","Alarme alimentation cadre source 1"],
3:[2,"Code_Acces","Code accès pour lancer un remplissage d\'un véhicule"],
4:[99,"DEF_AU","Défaut arret urgence"],
5:[99,"DEF_C1","Défaut moteur du compresseur H2 C1"],
6:[99,"DEF_C10","Défaut moteur du compresseur d\'air comprimé C10"],
7:[99,"DEF_C2","Défaut moteur C2"],
8:[99,"DEF_CHUTEP","Défaut chute de pression intempestive"],
9:[99,"DEF_DELTAP","Défaut contrôle delta P (étanchéité du flexible au démarrage d\'un remplissage <= 2barg)"],
10:[3,"DEF_MOT","DEFAUTS GENERAL"],
11:[99,"DEF_PT21B","DEFAUT PRESSION BASSE AMONT COMPRESSEUR"],
12:[99,"DEF_PT21H","Défaut pression haute en amont du compresseur H2 (>=200barg)"],
13:[99,"DEF_PT22H","Défaut pression haute en aval du compresseur H2 (>=430 barg)"],
14:[99,"DEF_S_KO","Défaut Stockages internes et sources externes épuisées"],
15:[4,"GC01","Concentration de l\'H2 en  pourcentage la LIE"],
16:[5,"MOP_L1","Messages opérateur ligne 1"],
17:[6,"MOP_L2","Message opérateur ligne 2"],
18:[7,"MOP_L3","Message opérateur ligne 3"],
19:[8,"Source1","Pression de la source 1 (barg)"],
20:[9,"PT10","Pression air comprimé (barg)"],
21:[10,"PT2-1","Pression en amont du compresseur (barg)"],
22:[11,"PT2-2","Pression en aval du compresseur (barg)"],
23:[12,"PT3-1","Pression stockage interne N°1"],
24:[13,"PT3-2","Pression Stockage interne N°2"],
25:[14,"PT4","Pression du réservoir du client (barg)"],
26:[15,"SP_PR","Recopie de la consigne du détendeur pneumatique (en barg)¶"],
27:[16,"TT-Ext","Température ambiante (°C)"],
28:[99,"secondes",""],
29:[17,"Source2","PT1-2 pression de la source externe n°2 (en barg)"],
30:[18,"DEBIT_INST","Débit instantané (g/s)"],
31:[19,"MASSE_CUMULEE","Totalisateur en (Kg)"],
32:[20,"MASSE_RECHARGE","Masse par recharge (en Kg)"],
33:[99,"VIEWON_DEF","pour afficher l\'état de la station sur viewon"],
34:[99,"VIEWON_PV_PR","permet de convertir des volt en barg dans viewon"],
35:[99,"VIEWON_SENDMAIL",""],
36:[99,"VIEWON_SP_PR","permet de convertir des Vdc en barg dans viewon"],
37:[21,"PT10-SFC",""],
38:[22,"PT3-2-SFC",""],
39:[23,"P1-finale","pression finale de la dernière recharge"],
40:[24,"DEF_MOT2","DEFAUTS LIES A LA COMPRESSION"],
41:[99,"DEF_FEU","DEFAUT FLAMMES DETECTEES"],
42:[99,"DEF_DFLAM","ALERTE DYSFONCTIONNEMENT DETECTEUR FLAMMES"],
43:[99,"DEF_DGAZ","ALERTE DYSFONCTIONNEMENT DETECTEUR GAZ"],
44:[99,"DEF_GAZ25","DEFAUT NIVEAU GAZ 25% LIE - ARRET D\'URGENCE"],
45:[99,"DEF_PT11","DEFAUT CAPTEUR PT1.1"],
46:[99,"DEF_PT12","DEFAUT CAPTEUR PT1.2"],
47:[99,"DEF_PT13","DEFAUT CAPTEUR PT1.3"],
48:[99,"DEF_PT31","DEFAUT CAPTEUR PT3.1"],
49:[99,"DEF_PT32","DEFAUT CAPTEUR PT3.2"],
50:[99,"DEF_PT10","DEFAUT CAPTEUR PT10"],
51:[99,"DEF_AIR_COMP","DEFAUT AIR COMPRIME"],
52:[99,"DEF_TEMP_EXT","DEFAUT TEMPERATURE AMBIANTE"],
53:[99,"DEF_PT21","DEFAUT CAPTEUR PT2.1"],
54:[99,"DEF_PT22","DEFAUT CAPTEUR PT2.2"],
55:[99,"DEF_MEMB_C21","DEFAUT MEMBRANE COMPRESSEUR C2.1"],
56:[99,"DEF_MEMB_C22","DEFAUT MEMBRANE COMPRESSEUR C2.2"],
57:[99,"DEF_OIL_C21","DEFAUT PRESSION HUILE COMPRESSEUR C2.1"],
58:[99,"DEF_OIL_C22","DEFAUT PRESSION HUILE COMPRESSEUR C2.2"],
59:[99,"DEF_CHILLER","DEFAUT CHILLER"],
60:[99,"DEF_PT31HAUT","DEFAUT PRESSION HAUTE STOCKAGE 1"],
61:[99,"DEF_PT32HAUT","DEFAUT PRESSION HAUTE STOCKAGE 2"],
62:[99,"DEF_PSHH2HAUT","DEFAUT PRESSION SECURITE HAUTE PSHH2"],
63:[99,"DEF_FLEX_H","DEFAUT PRESSION FLEXIBLE ELEVEE"],
64:[99,"DEF_PT4","DEFAUT CAPTEUR PT4"],
65:[99,"DEF_20G_S","DEFAUT DEBIT HAUT"],
66:[99,"DEF_PSHH4HAUT","DEFAUT PRESSION SECURITE HAUTE PSHH4"],
67:[99,"DEF_S2_KO","ALERTE ALIMENTATION CADRE SOURCE 2"],
68:[99,"DEF_S3_KO","ALERTE ALIMENTATION CADRE SOURCE 3"],
69:[99,"DEF_GAZ10","ALERTE NIVEAU GAZ 10% LIE"],
70:[99,"DEF_T_C1","ALERTE TEMPERATURE COMPRESSEUR C1"],
71:[99,"DEF_T_C2","ALERTE TEMPERATURE COMPRESSEUR C2"],
72:[99,"DEF_PT10H","ALERTE PRESSION SOURCE(S) ELEVEE(S)"],
73:[25,"DEF_MOT1","DEFAUTS LIES A LA DISTRIBUTION"],
74:[26,"Cons-PCV4","consigne du pcv4 en barg"],
75:[99,"Test_sms_THT",""],
76:[99,"Test_sms_THT_Grp",""],
79:[27,"Pveh","pression véhicule (en barg)"],
80:[28,"Tveh","Température vehicule"],
81:[29,"Tsortie_comp","température sortie compresseur"],
82:[30,"Tdistrib","Température de distribution"],
83:[31,"Tdetect_incendie","température détection incendie zone compression (en°C)"],
84:[99,"DEF_GC01_filtre",""],
85:[99,"Seuil_Anticipation",""],
86:[99,"Seuil_Source1_ok",""],
87:[99,"Seuil_Source2_ok",""],
88:[99,"Seuil_PT1_KO",""],
89:[99,"Flag_Def_S1_KO",""],
90:[99,"Flag_Def_S2_KO",""],
91:[99,"GC01_filtre",""],
92:[99,"unlock_HRS","Signal permettant de débloquer la station via un système extérieur (ex FillnDrive) (1= déblocage de la station)"],
93:[99,"GSM_LEV","niveau de la 3G"],
94:[32,"COM-VCHSS","Volume du réservoir véhicule selon SAEJ2799 (M3)"],
95:[99,"test",""],
96:[99,"unlock",""],
97:[33,"Valeur_P0","Valeur P0 selon SAEJ-2601 (bar)"],
98:[34,"Mem_P_INIT_V0","Mémoire pression initial V0 selon SAEJ-2601(bar)"],
99:[35,"Mem_P_Finale_V0","Mémoire pression finale V0 selon SAEJ-2601(bar)"],
100:[36,"Cpt_Masse_H2","Compteur masse H2 V0 selon SAEJ-2601"],
101:[37,"APRR","Valeur Calculée APRR selon SAEJ-2601 (bar/min)"],
102:[38,"PTarget","Valeur calculée PTarget selon SAEJ-2601 (bar)"],
103:[39,"Valeur_V0","Valeur calculée V0 selon SAEJ-2601 (l)"],
104:[40,"CPT_deb_nul","Compteur débit nul selon SAEJ-2601 (l)"],
105:[99,"DEF_T_HYCOMP","DEFAUT TEMPERATURE HAUTE GAZ SORTIE COMPRESSEUR"],
106:[99,"DEF_CORRIDOR","DEFAUT PRESSION EN DEHORS DU CORRIDOR THEORIQUE DE DISTRIBUTION"],
107:[99,"DEF_CPT_DEBMASS_V0","DEFAUT COMPTAGE IMPULSION DEBIMETRE MASSIQUE LORS DU CALCUL V0"],
108:[99,"DEF_CPT_PAUSEDEB","DEFAUT NOMBRE DE PAUSE DE DEBIT SUPERIEURES A 10 PENDANT DISTRIBUTION"],
109:[41,"ManC10","commande manuelle moteur C10"],
110:[42,"ManC21","commande manuelle moteur C2"],
111:[43,"ManGF","commande manuelle  Chiller"],
112:[44,"ManVFC1-1","commande manuelle VFC1-1"],
113:[45,"ManVFC1-2","commande manuelle VFC1-2"],
114:[46,"ManVFC2-1","commande manuelle VFC2-1"],
115:[47,"ManVFC2-2","commande manuelle VFC2-2"],
116:[48,"ManVFC2-3","commande manuelle VFC2-3"],
117:[49,"ManVFC3-1","commande manuelle VFC3-1"],
118:[50,"ManVFC3-2","commande manuelle VFC3-2"],
119:[51,"ManVFC4-1","commande manuelle VFC4-1"],
120:[52,"ManVFC4-2","commande manuelle VFC4-2"],
121:[53,"Mode_Manuel","activer le mode manuel"]}






DataToSave = [1,
2,
3,
4,
5,
6,
7,
8,
9,
10,
11,
12,
13,
14,
15,
16,
17,
18,
19,
20,
21,
22,
23,
24,
25,
26,
27,
28,
29,
30,
31,
32,
33,
34,
35,
36,
37,
38,
39,
40,
41,
42,
43,
44,
45,
46,
47,
48,
49,
50,
51,
52,
53,
54,
55,
56,
57,
58,
59,
60,
61,
62,
63,
64,
65,
66,
67,
68,
69,
70,
71,
72,
73,
74,
75,
76,
79,
80,
81,
82,
83,
84,
85,
86,
87,
88,
89,
90,
91,
92,
93,
94,
95,
96,
97,
98,
99,
100,
101,
102,
103,
104,
105,
106,
107,
108,
109,
110,
111,
112,
113,
114,
115,
116,
117,
118,
119,
120,
121]

for Tag in DataToSave:
	TagArray = IDsTag[Tag]
	TagName = TagArray[1]
	print(TagName)

	path = 'X:\\McView Historisation\\HRS-Rouen\\' + str(TagName) + '.csv'
	InitDataFrames(StartUpFile,path)



